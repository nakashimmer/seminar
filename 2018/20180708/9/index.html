<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<link rel="stylesheet" href="../iframe.css">
		<link href="https://fonts.googleapis.com/earlyaccess/roundedmplus1c.css" rel="stylesheet" />
		<style>
			button{font-size:30px;padding:0.3em;border-radius:10px;}
			select{font-size:30px;padding:0.3em;border-radius:10px;height:1.5em;}
			textarea{font-size:30px;height:4em;width:50%;vertical-align:top;}
		</style>
	</head>
	<body>	
		<div id="wrap">
			<h1>â‘¥Web Speech APIã§éŸ³å£°èª­ä¸Š</h1>
			<ol>
				<li>éŸ³å£°ã®ç¨®é¡ã‚’é¸æŠâ†’<span id=voices><button onclick="voice();">é¸æŠ</button></span></li>
				<li>è¨€èªã‚’é¸æŠâ†’<select id=lang>
					<option value="ja-JP" selected>æ—¥æœ¬èª</option>
					<option value="en-US">è‹±èª</option>
				</select></li>
				<li>ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›â‡’
					<textarea id=input>ã“ã‚“ã«ã¡ã¯ã€‚ã¿ãªã•ã‚“ã€‚</textarea>
				</li>
				<li><button onclick="mySpeech();">èª­ä¸Š</button></li>
				</li>
				<li><p onclick="nyuryoku();">ğŸ¤<span id="msg"></span></p></li>
		</ol>
		</div>

<script>

	//ãƒœã‚¤ã‚¹ã®ç¨®é¡

	var voices = speechSynthesis.getVoices();
	
	function voice(){
		voices = speechSynthesis.getVoices();
		var length=voices.length;
		var voiceStr="<select id=voice>";
		console.log(length);
		
		for(var i=0;i<length;i++){
			if(voices[i]){
				if(voices[i].name==="Google æ—¥æœ¬èª"){var sel="selected"}else{var sel=""};
				voiceStr+="<option value="+i+" "+sel+">"+voices[i].name+"</option>";
				
			}
		}
		voiceStr+="</select>";
		
		$id("voices").innerHTML=voiceStr;

	}

	//ãƒ†ã‚­ã‚¹ãƒˆèª­ã¿ä¸Šã’
	function mySpeech(){
		var input = $id("input").value;
		var voice = parseInt($id("voice").value);
		var input = new SpeechSynthesisUtterance(input);
		var lang = $id("lang").value
		input.lang = lang;
		var voices = speechSynthesis.getVoices();
		input.voice = voices[voice];
		speechSynthesis.speak(input);
	}

	//éŸ³å£°èªè­˜
	function nyuryoku(){
		var recognition = new webkitSpeechRecognition();	//éŸ³å£°èªè­˜ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆ
		recognition.lang = $id("lang").value;	//è¨€èªè¨­å®š
		recognition.start();	//èªè­˜é–‹å§‹
		$id("msg").innerHTML="ã—ã‚ƒã¹ã£ã¦ãã ã•ã„";
		// çµ‚äº†æ™‚ãƒˆãƒªã‚¬ãƒ¼
		recognition.addEventListener('result', function(e){
			$id("msg").innerHTML="çµ‚äº†";
			var rec = e.results.item(0).item(0).transcript;	//æ–‡å­—åˆ—æŠ½å‡º
			
			//èªè­˜æ–‡å­—åˆ—ã‚’åŠ å·¥
			//â‘ æ–‡å­—ã‚’æ›¸ãæ›ãˆ
			rec=rec.replace("ä¸­å³¶","ã‚¤ã‚±ãƒ¡ãƒ³ä¸­å³¶");
			rec=rec.replace("ãªã‹ã—ã¾","ã‚¤ã‚±ãƒ¡ãƒ³ä¸­å³¶");
			//â‘¡æ™‚é–“ã‚’å›ç­”
			var now=new Date();
			rec=rec.replace("ä½•æ™‚",now.getHours()+"æ™‚"+now.getMinutes()+"åˆ†ã§ã™");

			$id("input").value=	rec;
			setTimeout(mySpeech,1000);	//1ç§’å¾Œã«mySpeechã‚’èµ·å‹•
		});
	}
	
	function $id(id){return document.getElementById(id);}
</script>

	</body>
</html>