<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<link rel="stylesheet" href="../index/iframe.css">
		<link href="https://fonts.googleapis.com/earlyaccess/roundedmplus1c.css" rel="stylesheet" />
		<style>
			*{margin:0;padding:0;}
			#table{
				border-collapse: collapse;
				display:flex;
				width:100%;
				border:3px solid black;
				border-right: none;
				background-color:white;
			}
			table *{color:black;}
			th,td{
				border:1px solid black;
				border-right:3px solid black;
				width:270px;
				font-size:20px !important;
			}
			th{background-color:#fff;}
			td{text-align:right;padding:0.5em;}
			tr:nth-of-type(1),
			tr:nth-of-type(7){
				border-bottom:5px double black;
			}
			input{
				font-size:20px;
				width:calc(100%);
				border:none;
				text-align:right;
			}


			.btn{
				margin:0 auto;
			}
			button{
				color:white;
				background-color: black;
				margin:1em 0 0 auto;
				font-size:20px;
			}
			th,td{width:12.5%;}

		</style>

		</style>
		<script src="https://unpkg.com/@tensorflow/tfjs"></script>
	</head>
	<body>
	<h1>ä¸€æ¬¡é–¢æ•°ã®å€¤ã‚’äºˆæ¸¬</h1>
		<div id="wrap">
		<p><a target="_blank" href="https://www.cis.twcu.ac.jp/~asakawa/MathBio2010/lesson13/index.html">ğŸ‘¿ãƒ‘ãƒ³ãƒ‡ãƒ¢ãƒ‹ã‚¦ãƒ </a></p>
		<ol>
			<li>â‘  (x,y)ã®å€¤ã®ã‚»ãƒƒãƒˆã‚’1ã€œ6å›ã¾ã§è¨­å®š</li>
			<li>â‘¡ 7å›ã®xã®å€¤ã‚’å…¥åŠ›ã—ã€Œäºˆæ¸¬ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™</li>
			<li>â‘¢ å­¦ç¿’ã‚’è¡Œã„7å›ã®yã«äºˆæ¸¬å€¤ãŒè¡¨ç¤ºã•ã‚Œã‚‹</li>
		</ol>
		
			<table id="table">
				<tr>
					<th>ãƒ‡ãƒ¼ã‚¿</th>
					<th>1</th>
					<th>2</th>
					<th>3</th>
					<th>4</th>
					<th>5</th>
					<th>6</th>
					<th>äºˆæ¸¬</th>
				</tr>
				<tr>	
					<th>xå€¤</th>
					<td><input type="text" class="x" value="0"></td>
					<td><input type="text" class="x" value="1"></td>
					<td><input type="text" class="x" value="2"></td>
					<td><input type="text" class="x" value="3"></td>
					<td><input type="text" class="x" value="4"></td>
					<td><input type="text" class="x" value="5"></td>
					<td>
						<input type="text" class="x" placeholder="â‘ " style="border:1px solid red;"><br>
						<button
							onclick="tsr();">â‘¡äºˆæ¸¬</button>
					</td>
				</tr>
				<tr>
					<th>yå€¤</th>
					<td><input type="text" class="y" value="-3"></td>
					<td><input type="text" class="y" value="-1"></td>
					<td><input type="text" class="y" value="1"></td>
					<td><input type="text" class="y" value="3"></td>
					<td><input type="text" class="y" value="5"></td>
					<td><input type="text" class="y" value="7"></td>
					<td class="y">â‘¢äºˆæ¸¬å€¤</td>
				</tr>
		</table>
		<p id="output"></p>

		<p><a href="https://www.tensorflow.org/js/?hl=ja" target="_blank">TensorFlow.jsï¼šãƒ–ãƒ©ã‚¦ã‚¶å†…ãŠã‚ˆã³ Node.js ä¸Šã§ãƒ¢ãƒ‡ãƒ«ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã¨ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è¡Œã†ãŸã‚ã® JavaScript ãƒ©ã‚¤ãƒ–ãƒ©ãƒª</a></p>
	

		<script>
		const x = document.getElementsByClassName("x");
		const y = document.getElementsByClassName("y");

		const output = document.getElementById("output");


		function xf(i){return parseFloat(x[i].value);}
		function yf(i){return parseFloat(y[i].value);}

		function tsr(){

			async function learnLinear(){

				//ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
				const model = tf.sequential();
				model.add(
					tf.layers.dense(
						{
							units: 1, 
							inputShape: [1]
						}
					)
				);

				model.compile(
					{
						loss: 'meanSquaredError',
						optimizer: 'sgd'
					}
				);

				//ãƒ‡ãƒ¼ã‚¿ç”¨æ„
				const xs = tf.tensor2d(
					[xf(0),xf(1),xf(2),xf(3),xf(4),xf(5)],[6, 1]
				);


				const ys = tf.tensor2d(
					[yf(0),yf(1),yf(2),yf(3),yf(4),yf(5)],[6, 1]
				);



				await model.fit(
					xs,
					ys,
					{epochs: 500,
					callbacks: {
							onEpochEnd: async (epoch, logs) => {
								console.log(epoch, logs);
								output.innerHTML = "<li>" + epoch + "å›/LogLoss=" + logs.loss + "</li>";
							},
						}}
				);

			//äºˆæ¸¬
				var result = model.predict(
					tf.tensor2d(
						[xf(6)],[1, 1]
					)
				)



				y[6].innerText = (""+result).slice(14).slice(0,-3);

			}

			learnLinear();
			
		}		
	</script>
	
	</body>
</html>
