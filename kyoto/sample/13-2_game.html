<!DOCTYPE html>
<meta charset=utf-8>
<title>シューティングゲーム</title>
<meta name=viewport content="width=device-width,user-scalable=no">

<style> 
*{margin:0; padding:0;}
#open,#play,#finish{
	width:320px;height:480px;border:1px solid gray;
	text-align:center}
#play,#finish{display:none;}
button{font-size:50px;margin:100px auto;}
</style>

<section id=open>
	<h1>START</h1>
	<button onclick="start()">開始</button>
</section>
<section id=play>
	<canvas id="canvas" width="320" height="480"></canvas>
</section>
<section id=finish>
	<h1>END</h1>
	<p>あなたの得点は<span id=result></span>です</p>
</section>

<script>
var canvas=document.getElementById("canvas"); 
var c=canvas.getContext("2d");
			
//変数の設定と初期化
var open=document.getElementById("open");
var play=document.getElementById("play");
var finish=document.getElementById("finish");
var result=document.getElementById("result");

var frame=0;									//全体のフレームカウント 
var target={x:250,y:100,dir:1};		//ターゲット（x位置と移動方向）
var player={x:250,y:400};				//プレイヤー（x位置）
var ball={x:-10,y:-10};					//ボール（x位置とy位置） 
var point=0;									//得点
var sound=new Audio("media/pon.mp3");		//効果音読込

var limit=10;									//制限時間
var timer;										//タイマー

function anime(){	//ルーチンのスクリプト———————————
	frame++;
	if(limit*50<=frame){end();}

	//画面をクリア
	c.clearRect(0,0,canvas.width,canvas.height);

	//targetと得点を描画
	c.save();
	c.translate(target.x,target.y);
	c.fillStyle="red";
	c.beginPath();
	c.moveTo(0,-10);
	c.lineTo(-25,10);
	c.lineTo(25,10);
	c.closePath();
	c.fill();

	c.font="20px sans-serif";
	c.textAlign="center";
	c.fillText(point,0,-10);
	c.restore();
	
	//playerを描画
	c.save();
	c.translate(player.x,player.y);
	c.fillStyle="blue";
	c.fillRect(-25,-5,50,10);
	c.restore();

	//ballを描画
	c.save();
	c.translate(ball.x,ball.y);
	c.fillStyle="green";
	c.beginPath();
	c.arc(0,0,10,0,2*Math.PI,false);
	c.fill();
	c.restore();

	//移動計算
	target.x+=target.dir;
	ball.y-=5;

	//壁衝突計算
	if(target.x<25||295<target.x){target.dir*=-1;}

	//得点ゲット
	if ((100 == ball.y) && (Math.abs(target.x - ball.x)<25)){
		point++;
		sound.play();
		ball.y=-100;
	}
}
//開始の処理 ———————————
function start(){
	sound.play();
	open.style.display="none";
	play.style.display="block";
	timer = setInterval(anime,50);
	anime();
}
//終了の処理———————————
function end(){
	clearInterval(timer);
	play.style.display="none";
	finish.style.display="block";
	result.innerHTML=point;
}
//シュートの処理———————————
canvas.addEventListener("mousedown",function(){
	ball.x = player.x;
	ball.y = player.y; 
});
//マウスが動いているときの処理———————————
canvas.addEventListener("mousemove",function(e){
	e.preventDefault();
	var rect = e.target.getBoundingClientRect();
	player.x = e.clientX - rect.left;
});
</script>